[Unit]
Description=Prometheus
After=syslog.target network.target

[Service]
Type=simple
# Systemd clears ANY environment configuration, so you need to set it over here again.
# NOTE: using EnvironmentFile will not work because:
# 1- systemd does not accept 'export FOO=bar'
# 2- Python does not have access to a instance var (example: FOO=bar)
#Environment="SOMETHING=value"
#Environment="ANOTHER=value2"
GuessMainPID=True
User={{ prometheus.user_settings.user }}
Group={{ prometheus.user_settings.group }}
WorkingDirectory={{ prometheus.working_dir }}
ExecStart={{ prometheus.bin_dir }}/prometheus \
    --config.file {{ prometheus.cfg_dir }}/prometheus.yml \
    --storage.tsdb.path {{ prometheus.var_dir }} \
    --web.console.templates={{ prometheus.cfg_dir }}/consoles \
    --web.console.libraries={{ prometheus.cfg_dir }}/console_libraries
ExecReload=/bin/kill -HUP $MAINPID
ExecStop=/bin/kill -9 $MAINPID
TimeoutSec=5

[Install]
WantedBy=multi-user.target
